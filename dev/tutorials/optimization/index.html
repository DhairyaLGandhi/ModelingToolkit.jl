<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Modeling Optimization Problems · ModelingToolkit.jl</title><meta name="title" content="Modeling Optimization Problems · ModelingToolkit.jl"/><meta property="og:title" content="Modeling Optimization Problems · ModelingToolkit.jl"/><meta property="twitter:title" content="Modeling Optimization Problems · ModelingToolkit.jl"/><meta name="description" content="Documentation for ModelingToolkit.jl."/><meta property="og:description" content="Documentation for ModelingToolkit.jl."/><meta property="twitter:description" content="Documentation for ModelingToolkit.jl."/><meta property="og:url" content="https://docs.sciml.ai/ModelingToolkit/stable/tutorials/optimization/"/><meta property="twitter:url" content="https://docs.sciml.ai/ModelingToolkit/stable/tutorials/optimization/"/><link rel="canonical" href="https://docs.sciml.ai/ModelingToolkit/stable/tutorials/optimization/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="ModelingToolkit.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">ModelingToolkit.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../ode_modeling/">Getting Started with ModelingToolkit.jl</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../acausal_components/">Acausal Component-Based Modeling</a></li><li><a class="tocitem" href="../nonlinear/">Modeling Nonlinear Systems</a></li><li class="is-active"><a class="tocitem" href>Modeling Optimization Problems</a><ul class="internal"><li><a class="tocitem" href="#Rosenbrock-Function-in-2D"><span>Rosenbrock Function in 2D</span></a></li><li><a class="tocitem" href="#Building-and-Solving-the-Optimization-Problem"><span>Building and Solving the Optimization Problem</span></a></li><li><a class="tocitem" href="#Rosenbrock-Function-with-Constraints"><span>Rosenbrock Function with Constraints</span></a></li><li><a class="tocitem" href="#Nested-Systems"><span>Nested Systems</span></a></li></ul></li><li><a class="tocitem" href="../modelingtoolkitize/">Modelingtoolkitize: Automatically Translating Numerical to Symbolic Code</a></li><li><a class="tocitem" href="../programmatically_generating/">Programmatically Generating and Scripting ODESystems</a></li><li><a class="tocitem" href="../stochastic_diffeq/">Modeling with Stochasticity</a></li><li><a class="tocitem" href="../parameter_identifiability/">Parameter Identifiability in ODE Models</a></li><li><a class="tocitem" href="../bifurcation_diagram_computation/">Bifurcation Diagrams</a></li><li><a class="tocitem" href="../domain_connections/">Domains</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><input class="collapse-toggle" id="menuitem-4-1" type="checkbox"/><label class="tocitem" for="menuitem-4-1"><span class="docs-label">Basic Examples</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../examples/higher_order/">Automatic Transformation of Nth Order ODEs to 1st Order ODEs</a></li><li><a class="tocitem" href="../../examples/spring_mass/">Component-Based Modeling of a Spring-Mass System</a></li><li><a class="tocitem" href="../../examples/modelingtoolkitize_index_reduction/">Automated Index Reduction of DAEs</a></li><li><a class="tocitem" href="../../examples/parsing/">Parsing Expressions into Solvable Systems</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-2" type="checkbox"/><label class="tocitem" for="menuitem-4-2"><span class="docs-label">Advanced Examples</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../examples/tearing_parallelism/">Exposing More Parallelism By Tearing Algebraic Equations in ODESystems</a></li><li><a class="tocitem" href="../../examples/sparse_jacobians/">Automated Sparse Analytical Jacobians</a></li><li><a class="tocitem" href="../../examples/perturbation/">Symbolic-Numeric Perturbation Theory for ODEs</a></li></ul></li></ul></li><li><span class="tocitem">Basics</span><ul><li><a class="tocitem" href="../../basics/AbstractSystem/">The AbstractSystem Interface</a></li><li><a class="tocitem" href="../../basics/ContextualVariables/">Contextual Variable Types</a></li><li><a class="tocitem" href="../../basics/Variable_metadata/">Symbolic Metadata</a></li><li><a class="tocitem" href="../../basics/Composition/">Composing Models and Building Reusable Components</a></li><li><a class="tocitem" href="../../basics/Events/">Event Handling and Callback Functions</a></li><li><a class="tocitem" href="../../basics/Linearization/">Linearization</a></li><li><a class="tocitem" href="../../basics/MTKModel_Connector/">Components and Connectors</a></li><li><a class="tocitem" href="../../basics/Validation/">Model Validation and Units</a></li><li><a class="tocitem" href="../../basics/DependencyGraphs/">Dependency Graphs</a></li><li><a class="tocitem" href="../../basics/FAQ/">Frequently Asked Questions</a></li></ul></li><li><span class="tocitem">System Types</span><ul><li><a class="tocitem" href="../../systems/ODESystem/">ODESystem</a></li><li><a class="tocitem" href="../../systems/SDESystem/">SDESystem</a></li><li><a class="tocitem" href="../../systems/JumpSystem/">JumpSystem</a></li><li><a class="tocitem" href="../../systems/NonlinearSystem/">NonlinearSystem</a></li><li><a class="tocitem" href="../../systems/OptimizationSystem/">OptimizationSystem</a></li><li><a class="tocitem" href="../../systems/DiscreteSystem/">DiscreteSystem</a></li><li><a class="tocitem" href="../../systems/PDESystem/">PDESystem</a></li></ul></li><li><a class="tocitem" href="../../comparison/">Comparison of ModelingToolkit vs Equation-Based and Block Modeling Languages</a></li><li><a class="tocitem" href="../../internals/">Internal Details</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>Modeling Optimization Problems</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Modeling Optimization Problems</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/SciML/ModelingToolkit.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/SciML/ModelingToolkit.jl/blob/master/docs/src/tutorials/optimization.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Modeling-Optimization-Problems"><a class="docs-heading-anchor" href="#Modeling-Optimization-Problems">Modeling Optimization Problems</a><a id="Modeling-Optimization-Problems-1"></a><a class="docs-heading-anchor-permalink" href="#Modeling-Optimization-Problems" title="Permalink"></a></h1><h2 id="Rosenbrock-Function-in-2D"><a class="docs-heading-anchor" href="#Rosenbrock-Function-in-2D">Rosenbrock Function in 2D</a><a id="Rosenbrock-Function-in-2D-1"></a><a class="docs-heading-anchor-permalink" href="#Rosenbrock-Function-in-2D" title="Permalink"></a></h2><p>Let&#39;s solve the classical <em>Rosenbrock function</em> in two dimensions.</p><p>First, we need to make some imports.</p><pre><code class="language-julia hljs">using ModelingToolkit, Optimization, OptimizationOptimJL</code></pre><p>Now we can define our optimization problem.</p><pre><code class="language-julia hljs">@variables begin
    x, [bounds = (-2.0, 2.0)]
    y, [bounds = (-1.0, 3.0)]
end
@parameters a=1 b=1
loss = (a - x)^2 + b * (y - x^2)^2
@named sys = OptimizationSystem(loss, [x, y], [a, b])</code></pre><p class="math-container">\[ \begin{equation}
\left( a - x \right)^{2} + \left( y - x^{2} \right)^{2} b
\end{equation}
 \]</p><p>A visualization of the objective function is depicted below.</p><p><img src="../obj_fun.png" alt="plot of the Rosenbrock function"/></p><h3 id="Explanation"><a class="docs-heading-anchor" href="#Explanation">Explanation</a><a id="Explanation-1"></a><a class="docs-heading-anchor-permalink" href="#Explanation" title="Permalink"></a></h3><p>Every optimization problem consists of a set of <em>optimization variables</em>. In this case, we create two variables. Additionally, we assign <em>box constraints</em> for each of them. In the next step, we create two parameters for the problem with <code>@parameters</code>. While it is not needed to do this, it makes it easier to <code>remake</code> the problem later with different values for the parameters. The <em>objective function</em> is specified as well and finally, everything is used to construct an <code>OptimizationSystem</code>.</p><h2 id="Building-and-Solving-the-Optimization-Problem"><a class="docs-heading-anchor" href="#Building-and-Solving-the-Optimization-Problem">Building and Solving the Optimization Problem</a><a id="Building-and-Solving-the-Optimization-Problem-1"></a><a class="docs-heading-anchor-permalink" href="#Building-and-Solving-the-Optimization-Problem" title="Permalink"></a></h2><p>Next, the actual <code>OptimizationProblem</code> can be created. At this stage, an initial guess <code>u0</code> for the optimization variables needs to be provided via map, using the symbols from before. Concrete values for the parameters of the system can also be provided or changed. However, if the parameters have default values assigned, they are used automatically.</p><pre><code class="language-julia hljs">u0 = [x =&gt; 1.0
    y =&gt; 2.0]
p = [a =&gt; 1.0
    b =&gt; 100.0]

prob = OptimizationProblem(sys, u0, p, grad = true, hess = true)
solve(prob, GradientDescent())</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">retcode: Success
u: 2-element Vector{Float64}:
 1.0000000135463598
 1.0000000271355158</code></pre><h2 id="Rosenbrock-Function-with-Constraints"><a class="docs-heading-anchor" href="#Rosenbrock-Function-with-Constraints">Rosenbrock Function with Constraints</a><a id="Rosenbrock-Function-with-Constraints-1"></a><a class="docs-heading-anchor-permalink" href="#Rosenbrock-Function-with-Constraints" title="Permalink"></a></h2><pre><code class="language-julia hljs">using ModelingToolkit, Optimization, OptimizationOptimJL

@variables begin
    x, [bounds = (-2.0, 2.0)]
    y, [bounds = (-1.0, 3.0)]
end
@parameters a=1 b=100
loss = (a - x)^2 + b * (y - x^2)^2
cons = [
    x^2 + y^2 ≲ 1,
]
@named sys = OptimizationSystem(loss, [x, y], [a, b], constraints = cons)
u0 = [x =&gt; 0.14
    y =&gt; 0.14]
prob = OptimizationProblem(sys, u0, grad = true, hess = true, cons_j = true, cons_h = true)
solve(prob, IPNewton())</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">retcode: Success
u: 2-element Vector{Float64}:
 0.7864151541684254
 0.6176983125233897</code></pre><p>A visualization of the objective function and the inequality constraint is depicted below.</p><p><img src="../obj_fun_c.png" alt="plot of the Rosenbrock function with constraint"/></p><h3 id="Explanation-2"><a class="docs-heading-anchor" href="#Explanation-2">Explanation</a><a class="docs-heading-anchor-permalink" href="#Explanation-2" title="Permalink"></a></h3><p>Equality and inequality constraints can be added to the <code>OptimizationSystem</code>. An equality constraint can be specified via an <code>Equation</code>, e.g., <code>x^2 + y^2 ~ 1</code>. While inequality constraints via an <code>Inequality</code>, e.g., <code>x^2 + y^2 ≲ 1</code>. The syntax is here <code>\lesssim</code> and <code>\gtrsim</code>.</p><h2 id="Nested-Systems"><a class="docs-heading-anchor" href="#Nested-Systems">Nested Systems</a><a id="Nested-Systems-1"></a><a class="docs-heading-anchor-permalink" href="#Nested-Systems" title="Permalink"></a></h2><p>Needs more text, but it&#39;s super cool and auto-parallelizes and sparsifies too. Plus, you can hierarchically nest systems to have it generate huge optimization problems.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../nonlinear/">« Modeling Nonlinear Systems</a><a class="docs-footer-nextpage" href="../modelingtoolkitize/">Modelingtoolkitize: Automatically Translating Numerical to Symbolic Code »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.2.0 on <span class="colophon-date" title="Thursday 30 November 2023 01:01">Thursday 30 November 2023</span>. Using Julia version 1.9.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
