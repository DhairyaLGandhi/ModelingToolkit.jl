<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>- · ModelingToolkit.jl</title><script async src="https://www.googletagmanager.com/gtag/js?id=UA-90474609-3"></script><script>  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-90474609-3', {'page_path': location.pathname + location.search + location.hash});
</script><script data-outdated-warner src="../../assets/warner.js"></script><link rel="canonical" href="https://docs.sciml.ai/ModelingToolkit/stable/basics/MTKModel_Connector/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="ModelingToolkit.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">ModelingToolkit.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../tutorials/ode_modeling/">Getting Started with ModelingToolkit.jl</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../../tutorials/acausal_components/">Acausal Component-Based Modeling</a></li><li><a class="tocitem" href="../../tutorials/nonlinear/">Modeling Nonlinear Systems</a></li><li><a class="tocitem" href="../../tutorials/optimization/">Modeling Optimization Problems</a></li><li><a class="tocitem" href="../../tutorials/modelingtoolkitize/">Modelingtoolkitize: Automatically Translating Numerical to Symbolic Code</a></li><li><a class="tocitem" href="../../tutorials/stochastic_diffeq/">Modeling with Stochasticity</a></li><li><a class="tocitem" href="../../tutorials/parameter_identifiability/">Parameter Identifiability in ODE Models</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><input class="collapse-toggle" id="menuitem-4-1" type="checkbox"/><label class="tocitem" for="menuitem-4-1"><span class="docs-label">Basic Examples</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../examples/higher_order/">Automatic Transformation of Nth Order ODEs to 1st Order ODEs</a></li><li><a class="tocitem" href="../../examples/spring_mass/">Component-Based Modeling of a Spring-Mass System</a></li><li><a class="tocitem" href="../../examples/modelingtoolkitize_index_reduction/">Automated Index Reduction of DAEs</a></li><li><a class="tocitem" href="../../examples/parsing/">Parsing Expressions into Solvable Systems</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-2" type="checkbox"/><label class="tocitem" for="menuitem-4-2"><span class="docs-label">Advanced Examples</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../examples/tearing_parallelism/">Exposing More Parallelism By Tearing Algebraic Equations in ODESystems</a></li><li><a class="tocitem" href="../../examples/sparse_jacobians/">Automated Sparse Analytical Jacobians</a></li><li><a class="tocitem" href="../../examples/perturbation/">Symbolic-Numeric Perturbation Theory for ODEs</a></li></ul></li></ul></li><li><span class="tocitem">Basics</span><ul><li><a class="tocitem" href="../AbstractSystem/">The AbstractSystem Interface</a></li><li><a class="tocitem" href="../ContextualVariables/">Contextual Variable Types</a></li><li><a class="tocitem" href="../Variable_metadata/">Symbolic metadata</a></li><li><a class="tocitem" href="../Composition/">Composing Models and Building Reusable Components</a></li><li><a class="tocitem" href="../Events/">Event Handling and Callback Functions</a></li><li><a class="tocitem" href="../Linearization/">Linearization</a></li><li><a class="tocitem" href="../Validation/">Model Validation and Units</a></li><li><a class="tocitem" href="../DependencyGraphs/">Dependency Graphs</a></li><li><a class="tocitem" href="../FAQ/">Frequently Asked Questions</a></li></ul></li><li><span class="tocitem">System Types</span><ul><li><a class="tocitem" href="../../systems/ODESystem/">ODESystem</a></li><li><a class="tocitem" href="../../systems/SDESystem/">SDESystem</a></li><li><a class="tocitem" href="../../systems/JumpSystem/">JumpSystem</a></li><li><a class="tocitem" href="../../systems/NonlinearSystem/">NonlinearSystem</a></li><li><a class="tocitem" href="../../systems/OptimizationSystem/">OptimizationSystem</a></li><li><a class="tocitem" href="../../systems/DiscreteSystem/">DiscreteSystem</a></li><li><a class="tocitem" href="../../systems/PDESystem/">PDESystem</a></li></ul></li><li><a class="tocitem" href="../../comparison/">Comparison of ModelingToolkit vs Equation-Based and Block Modeling Languages</a></li><li><a class="tocitem" href="../../internals/">Internal Details</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>-</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>-</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/SciML/ModelingToolkit.jl/blob/master/docs/src/basics/MTKModel_Connector.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h2 id="Defining-components-with-@mtkmodel"><a class="docs-heading-anchor" href="#Defining-components-with-@mtkmodel">Defining components with <code>@mtkmodel</code></a><a id="Defining-components-with-@mtkmodel-1"></a><a class="docs-heading-anchor-permalink" href="#Defining-components-with-@mtkmodel" title="Permalink"></a></h2><p><code>@mtkmodel</code> is a convenience macro to define ModelingToolkit components. It returns <code>ModelingToolkit.Model</code>, which includes a constructor that returns an ODESystem, a <code>structure</code> dictionary with metadata and flag <code>isconnector</code> which is set to <code>false</code>.</p><h3 id="What-can-an-MTK-Model-definition-have?"><a class="docs-heading-anchor" href="#What-can-an-MTK-Model-definition-have?">What can an MTK-Model definition have?</a><a id="What-can-an-MTK-Model-definition-have?-1"></a><a class="docs-heading-anchor-permalink" href="#What-can-an-MTK-Model-definition-have?" title="Permalink"></a></h3><p><code>@mtkmodel</code> definition contains begin blocks of</p><ul><li><code>@components</code>: for listing sub-components of the system</li><li><code>@equations</code>: for the list of equations</li><li><code>@extend</code>: for extending a base system and unpacking its states</li><li><code>@parameters</code>: for specifying the symbolic parameters</li><li><code>@structural_parameters</code>: for specifying non-symbolic parameters</li><li><code>@variables</code>: for specifing the states</li></ul><p>Let&#39;s explore these in more detail with the following example:</p><pre><code class="language-julia hljs">using ModelingToolkit

@mtkmodel ModelA begin
    @parameters begin
        k1
        k2
    end
end

@mtkmodel ModelB begin
    @parameters begin
        p1 = 1.0, [description = &quot;Parameter of ModelB&quot;]
        p2 = 1.0, [description = &quot;Parameter of ModelB&quot;]
    end
end

@mtkmodel ModelC begin
    @structural_parameters begin
        f = sin
    end
    begin
        v_var = 1.0
    end
    @variables begin
        v(t) = v_var
    end
    @extend p1, p2 = model_b = ModelB(; p1)
    @components begin
        model_a = ModelA(; k1)
    end
    @equations begin
        model_a.k1 ~ f(v)
    end
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">ModelingToolkit.Model{typeof(Main.var&quot;Main&quot;.__ModelC__), Dict{Symbol, Any}}(Main.var&quot;Main&quot;.__ModelC__, Dict{Symbol, Any}(:components =&gt; [[:model_a, :ModelA]], :variables =&gt; Dict{Symbol, Dict{Symbol, Any}}(:v =&gt; Dict(:default =&gt; :v_var)), :kwargs =&gt; Dict{Symbol, Any}(:f =&gt; :sin, :v =&gt; :v_var, :p1 =&gt; nothing, :model_a__k1 =&gt; nothing), :independent_variable =&gt; t, :extend =&gt; Any[[:p1, :p2], :model_b, :ModelB], :equations =&gt; [&quot;model_a.k1 ~ f(v)&quot;]), false)</code></pre><h4 id="@parameters-and-@variables-begin-block"><a class="docs-heading-anchor" href="#@parameters-and-@variables-begin-block"><code>@parameters</code> and <code>@variables</code> begin block</a><a id="@parameters-and-@variables-begin-block-1"></a><a class="docs-heading-anchor-permalink" href="#@parameters-and-@variables-begin-block" title="Permalink"></a></h4><ul><li>Parameters and variables are declared with respective begin blocks.</li><li>Variables must be functions of an independent variable.</li><li>Optionally, default values and metadata can be specified for these parameters and variables. See <code>ModelB</code> in the above example.</li><li>Along with creating parameters and variables, keyword arguments of same name with default value <code>nothing</code> are created.</li><li>Whenever a parameter or variable has default value, for example <code>v(t) = 0.0</code>, a symbolic variable named <code>v</code> with default value 0.0 and a keyword argument <code>v</code>, with default value <code>nothing</code> are created. &lt;br&gt; This way, users can optionally pass new value of <code>v</code> while creating a component.</li></ul><pre><code class="language-julia hljs">julia &gt; @named model_c = ModelC(; v = 2.0);

julia &gt; ModelingToolkit.getdefault(model_c.v)
2.0</code></pre><h4 id="@structural_parameters-begin-block"><a class="docs-heading-anchor" href="#@structural_parameters-begin-block"><code>@structural_parameters</code> begin block</a><a id="@structural_parameters-begin-block-1"></a><a class="docs-heading-anchor-permalink" href="#@structural_parameters-begin-block" title="Permalink"></a></h4><ul><li>This block is for non symbolic input arguements. These are for inputs that usually are not meant to be part of components; but influence how they are defined. One can list inputs like boolean flags, functions etc... here.</li><li>Whenever default values are specified, unlike parameters/variables, they are reflected in the keyword argument list.</li></ul><h4 id="@extend-block"><a class="docs-heading-anchor" href="#@extend-block"><code>@extend</code> block</a><a id="@extend-block-1"></a><a class="docs-heading-anchor-permalink" href="#@extend-block" title="Permalink"></a></h4><p>To extend a partial system,</p><ul><li>List the variables to unpack. If there is a single variable, explicitly specify it as a tuple.</li><li>Give a name to the base system</li><li>List the kwargs of the base system that should be listed as kwargs of the main component.</li><li>Note that in above example, <code>p1</code> is promoted as an argument of <code>ModelC</code>. Users can set the value of <code>p1</code> as</li></ul><pre><code class="language-julia hljs">julia&gt; @named model_c = ModelC(; p1 = 2.0)
</code></pre><p>However, as <code>p2</code> isn&#39;t listed in the model definition, its default can&#39;t be modified by users.</p><h4 id="@components-begin-block"><a class="docs-heading-anchor" href="#@components-begin-block"><code>@components</code> begin block</a><a id="@components-begin-block-1"></a><a class="docs-heading-anchor-permalink" href="#@components-begin-block" title="Permalink"></a></h4><ul><li>Declare the subcomponents within <code>@components</code> begin block.</li><li>The arguments in these subcomponents are promoted as keyword arguments as <code>subcomponent_name__argname</code> with <code>nothing</code> as default value.</li><li>Whenever components are created with <code>@named</code> macro, these can be accessed with <code>.</code> operator as <code>subcomponent_name.argname</code></li><li>In the above example, <code>k1</code> of <code>model_a</code> can be set in following ways:</li></ul><pre><code class="language-julia hljs">julia&gt; @named model_c1 = ModelC(; model_a.k1 = 1);</code></pre><p>And as <code>k2</code> isn&#39;t listed in the sub-component definition of <code>ModelC</code>, its default value can&#39;t be modified by users.</p><h4 id="@equations-begin-block"><a class="docs-heading-anchor" href="#@equations-begin-block"><code>@equations</code> begin block</a><a id="@equations-begin-block-1"></a><a class="docs-heading-anchor-permalink" href="#@equations-begin-block" title="Permalink"></a></h4><ul><li>List all the equations here</li></ul><h4 id="A-begin-block"><a class="docs-heading-anchor" href="#A-begin-block">A begin block</a><a id="A-begin-block-1"></a><a class="docs-heading-anchor-permalink" href="#A-begin-block" title="Permalink"></a></h4><ul><li>Any other Julia operations can be included with dedicated begin blocks.</li></ul><h2 id="Defining-connectors-with-@connector"><a class="docs-heading-anchor" href="#Defining-connectors-with-@connector">Defining connectors with <code>@connector</code></a><a id="Defining-connectors-with-@connector-1"></a><a class="docs-heading-anchor-permalink" href="#Defining-connectors-with-@connector" title="Permalink"></a></h2><p><code>@connector</code> returns <code>ModelingToolkit.Model</code>. It includes a constructor that returns a connector ODESystem, a <code>structure</code> dictionary with metadata and flag <code>isconnector</code> which is set to <code>true</code>.</p><p>A simple connector can be defined with syntax similar to following example:</p><pre><code class="language-julia hljs">using ModelingToolkit

@connector Pin begin
    v(t) = 0.0, [description = &quot;Voltage&quot;]
    i(t), [connect = Flow]
end</code></pre><ul><li>Variables (as function of independent variable) are listed out in the definition. These variables can optionally have default values and metadata like <code>descrption</code>, <code>connect</code> and so on.</li></ul><p><code>@connector</code>s accepts begin blocks of <code>@components</code>, <code>@equations</code>, <code>@extend</code>, <code>@parameters</code>, <code>@structural_parameters</code>, <code>@variables</code>. These keywords mean the same as described above for <code>@mtkmodel</code>.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>For more examples of usage, checkout <a href="https://github.com/SciML/ModelingToolkitStandardLibrary.jl/">ModelingToolkitStandardLibrary.jl</a></p></div></div><ul><li><ul><li><ul><li></li></ul></li></ul></li></ul><h3 id="What&#39;s-a-structure-dictionary?"><a class="docs-heading-anchor" href="#What&#39;s-a-structure-dictionary?">What&#39;s a <code>structure</code> dictionary?</a><a id="What&#39;s-a-structure-dictionary?-1"></a><a class="docs-heading-anchor-permalink" href="#What&#39;s-a-structure-dictionary?" title="Permalink"></a></h3><p>For components defined with <code>@mtkmodel</code> or <code>@connector</code>, a dictionary with metadata is created. It lists <code>:components</code> (sub-component list), <code>:extend</code> (the extended states and base system), <code>:parameters</code>, <code>:variables</code>, <span>$:kwargs$</span> (list of keyword arguments), <code>:independent_variable</code>, <code>:equations</code>.</p><p>For example, the structure of <code>ModelC</code> is:</p><pre><code class="language-julia hljs">julia&gt; ModelC.structure
Dict{Symbol, Any} with 6 entries:
  :components           =&gt; [[:model_a, :ModelA]]
  :variables            =&gt; Dict{Symbol, Dict{Symbol, Any}}(:v=&gt;Dict(:default=&gt;:v_var))
  :kwargs               =&gt; Dict{Symbol, Any}(:f=&gt;:sin, :v=&gt;:v_var, :p1=&gt;nothing, :model_a__k1=&gt;nothing)
  :independent_variable =&gt; t
  :extend               =&gt; Any[[:p1, :p2], :model_b, :ModelB]
  :equations            =&gt; [&quot;model_a.k1 ~ f(v)&quot;]</code></pre></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Thursday 14 September 2023 16:19">Thursday 14 September 2023</span>. Using Julia version 1.9.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
